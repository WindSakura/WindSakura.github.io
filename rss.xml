<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Passi0nfruit</title>
        <link>http://windsakura.github.io</link>
        <description></description>
        <language>zh-CN</language>
        <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
        <lastBuildDate>Fri, 01 Nov 2024 14:14:27 +0800</lastBuildDate>
        <item>
            <guid isPermalink="true">http://windsakura.github.io/2024/11/01/%E6%97%A5%E5%8C%BA/</guid>
            <title>日区软件乱码解决</title>
            <link>http://windsakura.github.io/2024/11/01/%E6%97%A5%E5%8C%BA/</link>
            <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;strong&gt;先说结果，我用 win10 成功打开试玩 DLsite 日文游戏，没有乱码，不用改系统时区，也没用上 Locale Emulator（可能是试玩的原因？希腊奶～）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;以下是方法&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;需要你安装的软件：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Locale Emulator（我没用上…），阿 B 有 up 做了详细的安装使用教程，这里就不多赘述&lt;/p&gt;
&lt;p&gt;描述：这个东西是用在解压缩后（游戏目录没乱码），一键指定时区来启动 exe 游戏程序的，本身不是汉化软件&lt;/p&gt;
&lt;p&gt;原作者链接：&lt;a href=&#34;https://github.com/xupefei/Locale-Emulator/releases&#34;&gt;https://github.com/xupefei/Locale-Emulator/releases&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;版本选择：2.4.1.0 （win10 测试通过，win11 使用 v2.5.0.0 以上版本）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;WinRAR 或者 7zip&lt;/p&gt;
&lt;p&gt;描述：通过解压缩工具指定语言来解压文件&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WinRAR&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;选中要解压的文件，ctrl + E, 选择日本，然后正常解压缩，轻松搞定&lt;/p&gt;
&lt;p&gt;但是收费，初次下载有 40 天试用，这里不提供破解方式，不过可以给一个关键词             “rarreg.key”&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;7zip&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;* 开源免费，但是要一丢丢操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;打开 7zip 安装目录，默认是 C:\Program Files\7-Zip&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://windsakura.github.io/2024/11/01/%E5%B1%8F%E5%B9%95%E9%9D%A2%E6%9D%BF%E9%80%89%E6%8B%A9/</guid>
            <title></title>
            <link>http://windsakura.github.io/2024/11/01/%E5%B1%8F%E5%B9%95%E9%9D%A2%E6%9D%BF%E9%80%89%E6%8B%A9/</link>
            <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;屏幕面板选择&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#屏幕面板选择&#34;&gt;#&lt;/a&gt; 屏幕面板选择&lt;/h1&gt;
&lt;h3 id=&#34;群创液晶模组n173hce-g33&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#群创液晶模组n173hce-g33&#34;&gt;#&lt;/a&gt; 群创液晶模组 N173HCE-G33&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;解析度&lt;/th&gt;
&lt;th&gt;1920(RGB)×1080  FHD  127PPI 100%SRGB&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;帧频率&lt;/td&gt;
&lt;td&gt;144HZ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;接口类型&lt;/td&gt;
&lt;td&gt;40 pins  eDP (4 Lanes) , eDP1.3 , 端子&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TB 价&lt;/td&gt;
&lt;td&gt;370&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.loli.net/2022/07/21/cuGnN2v9poMfLFl.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;京东方液晶模组ne156qhm-ny1&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#京东方液晶模组ne156qhm-ny1&#34;&gt;#&lt;/a&gt; 京东方液晶模组 NE156QHM-NY1&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;解析度&lt;/th&gt;
&lt;th&gt;2560(RGB)×1440  Quad-HD  188PPI&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;帧频率&lt;/td&gt;
&lt;td&gt;165HZ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;接口类型&lt;/td&gt;
&lt;td&gt;40 pins  eDP (4 Lanes) , eDP1.4 , HBR2 (5.4G/lane) , 端子&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;TB 价&lt;/td&gt;
&lt;td&gt;240 到手&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.loli.net/2022/07/21/hGINwf42gjqbEHe.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;京东方液晶模组ne173qhm-ny2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#京东方液晶模组ne173qhm-ny2&#34;&gt;#&lt;/a&gt; 京东方液晶模组 NE173QHM-NY2&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;解析度&lt;/th&gt;
&lt;th&gt;2560(RGB)×1440, Quad-HD, 170PPI&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;帧频率&lt;/td&gt;
&lt;td&gt;165HZ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;信号接口&lt;/td&gt;
&lt;td&gt;eDP (4 Lanes) , eDP1.4 , HBR2 (5.4G/lane) , 40 pins , 端子&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TB 价&lt;/td&gt;
&lt;td&gt;450&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&#34;https://s2.loli.net/2022/07/21/JXc3g8fw24AoWtY.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://windsakura.github.io/2024/11/01/%E5%A4%A9%E7%BF%BC%E4%BA%91Ts3/</guid>
            <title>天翼云自用搭建</title>
            <link>http://windsakura.github.io/2024/11/01/%E5%A4%A9%E7%BF%BC%E4%BA%91Ts3/</link>
            <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;byd 天翼云弹性计算服务器用的 Ubuntu 16.84.7 LTS&lt;/p&gt;
&lt;h2 id=&#34;1openssl升级前置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1openssl升级前置&#34;&gt;#&lt;/a&gt; 1.openssl 升级前置&lt;/h2&gt;
&lt;p&gt;openssl1.1.1 以下会没有 &lt;code&gt;+addext&lt;/code&gt;  选项，记得升级&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;root@vm:~# which openssl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/usr/bin/openssl&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#获取openssl1.1.1w source/old&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://www.openssl.org/source/old/1.1.1/openssl-1.1.1w.tar.gz --no-check-certificate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#安装依赖/Ubuntu&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt install -y zlib1g&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt install -y zlib1g-dev&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt install -y gcc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#安装Perl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://www.cpan.org/src/5.0/perl-5.40.0.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#解压perl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxvf perl-5.40.0.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#建立文件目录&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir /usr/local/perl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd perl-5.40.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./Configure -des -Dprefix=/usr/local/perl -Dusethreads –Uversiononly&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#编译&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#安装&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make install&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#查看版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;perl -v&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;2升级openssl&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2升级openssl&#34;&gt;#&lt;/a&gt; 2. 升级 openssl&lt;/h2&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#解压openssl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxvf openssl-1.1.1w.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#调用zlib共享库&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd openssl-1.1.1w&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./config shared zlib&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#编译&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#安装&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;记得备份旧版本 openssl&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mv /usr/bin/openssl /usr/bin/openssl.old&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mv /usr/lib64/openssl /usr/lib64/openssl.old&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用新版&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ln -s /usr/local/bin/openssl /usr/bin/openssl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ln -s /usr/local/include/openssl/ /usr/include/openssl&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;更新动态链接库数据&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;echo &amp;quot;/usr/local/lib/&amp;quot; &amp;gt;&amp;gt; /etc/ld.so.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;重新加载动态链接库&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ldconfig -v&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看新版本&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;openssl version&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;3安装tailscale-derp基于ubuntu&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#3安装tailscale-derp基于ubuntu&#34;&gt;#&lt;/a&gt; 3. 安装 tailscale derp (基于 Ubuntu)&lt;/h2&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 更新软件源&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apt update &amp;amp;&amp;amp; apt upgrade&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 安装相关依赖&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apt install -y wget git openssl curl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 拉取go 可打开https://go.dev/dl/查看最新版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd /root&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://go.dev/dl/go1.20.7inux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 解压&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rm -rf /usr/local/go &amp;amp;&amp;amp; tar -C /usr/local -xzf go1.20.5.linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 查看版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;export PATH=$PATH:/usr/local/go/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;go version&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 添加环境变量&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;echo &amp;quot;export PATH=$PATH:/usr/local/go/bin&amp;quot; &amp;gt;&amp;gt; /etc/profile&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;source /etc/profile&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 让go使用国内代理源(国外主机忽略)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;go env -w GO111MODULE=on&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;go env -w GOPROXY=https://goproxy.cn,direct&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 拉取并编译derper&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;go install tailscale.com/cmd/derper@main&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 进入到编译好的文件夹(不要直接复制命令，按实际情况填写)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd /root/go/pkg/mod/tailscale.com@v1.1.1-xxxx/cmd/derper/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 打开cert.go文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vi cert.go&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 注释以下信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;func (m *manualCertManager) getCertificate(hi *tls.ClientHelloInfo) (*tls.Certificate, error) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    // if hi.ServerName != m.hostname &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    //     return nil, fmt.Errorf(&amp;quot;cert mismatch with hostname: %q&amp;quot;, hi.ServerName)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    // &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 编译并输出到/etc/derp/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;go build -o /etc/derp/derper&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 查看是否存在derper文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd /root&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ls /etc/derp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 自签域名(derp.myself.com可随意编写，命令中四处需要一致)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -nodes -keyout /etc/derp/derp.myself.com.key -out /etc/derp/derp.myself.com.crt -subj &amp;quot;/CN=derp.myself.com&amp;quot; -addext &amp;quot;subjectAltName=DNS:derp.myself.com&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 自行开放33445(tcp)、2478(udp)端口&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;设置开机自启&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;gt; /etc/systemd/system/derp.service &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[Unit]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Description=TS Derper&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;After=network.target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Wants=network.target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[Service]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;User=root&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Restart=always&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ExecStart=/etc/derp/derper -hostname derp.myself.com -a :33445 -http-port 33446 -certmode manual -certdir /etc/derp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RestartPreventExitStatus=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[Install]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;WantedBy=multi-user.target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;EOF&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 设置开机自启&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl enable derp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 启动derp服务&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl start derp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;验证derp服务&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#验证derp服务&#34;&gt;#&lt;/a&gt; 验证 derp 服务&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://cdn.jsdelivr.net/gh/WindSakura/imgs@main/image-20241031235748258.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;打开 &lt;a href=&#34;https://login.tailscale.com/admin/acls/file&#34;&gt;Tailscale 控制台&lt;/a&gt;，按照图中位置添加以下内容：&lt;/p&gt;
&lt;p&gt;其中 IPv4、IPv6、RegionCode、RegionName 填写自己的&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;derpMap&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    //&amp;quot;OmitDefaultRegions&amp;quot;: false,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;OmitDefaultRegions&amp;quot;: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;Regions&amp;quot;: &amp;#123;&amp;quot;901&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;RegionID&amp;quot;:   901,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;RegionCode&amp;quot;: &amp;quot;EndlessJY&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;RegionName&amp;quot;: &amp;quot;EndlessJY Derper&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;Nodes&amp;quot;: [&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;Name&amp;quot;:             &amp;quot;901a&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;RegionID&amp;quot;:         901,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;IPv4&amp;quot;:             &amp;quot;xxxx&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;IPv6&amp;quot;:             &amp;quot;xxxx&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;DERPPort&amp;quot;:         33445,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;InsecureForTests&amp;quot;: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 当以上配置文件中&amp;quot;OmitDefaultRegions&amp;quot;: true时表示只启用自建DERP Server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[root@OpenWrt:01:01 PM ~] # tailscale netcheck&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Report:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * UDP: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * IPv4: yes, xxxx:xxx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * IPv6: yes, [xxxx]:xxx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * MappingVariesByDestIP: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * HairPinning: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * PortMapping: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * Nearest DERP: EndlessJY Derper&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * DERP latency:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - EndlessJY: 56.3ms  (EndlessJY Derper)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 当以上配置文件中&amp;quot;OmitDefaultRegions&amp;quot;: false时表示启用全部(官方和自建)DERP Server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 此时Tailscale会自动选择延迟最低节点&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[root@OpenWrt:01:03 PM ~] # tailscale netcheck&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Report:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * UDP: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * IPv4: yes, xxx:xxx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * IPv6: yes, [xxx]:xxx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * MappingVariesByDestIP: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * HairPinning: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * PortMapping: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * Nearest DERP: EndlessJY Derper&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        * DERP latency:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - EndlessJY: 55ms    (EndlessJY Derper)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - hkg: 56.4ms  (Hong Kong)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - tok: 108.4ms (Tokyo)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - syd: 178.8ms (Sydney)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - sea: 181.1ms (Seattle)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - lax: 202.1ms (Los Angeles)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - sfo: 208.9ms (San Francisco)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - sin: 231.2ms (Singapore)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - ord: 233.1ms (Chicago)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - den: 234.9ms (Denver)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - dfw: 237.7ms (Dallas)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - nyc: 246.8ms (New York City)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - tor: 261.2ms (Toronto)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - mia: 262.1ms (Miami)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - hnl: 262.6ms (Honolulu)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - lhr: 266.6ms (London)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - par: 269.1ms (Paris)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - ams: 272.9ms (Amsterdam)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - blr: 273.7ms (Bangalore)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - fra: 285.5ms (Frankfurt)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - mad: 285.7ms (Madrid)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - waw: 295ms   (Warsaw)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - dbi: 330.6ms (Dubai)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - nai: 344ms   (Nairobi)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - sao: 371.2ms (São Paulo)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - jnb: 443.7ms (Johannesburg)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/WindSakura/imgs/blob/main/image-20241101000231832.png?raw=true&#34; alt=&#34;image-20241101000231832&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://windsakura.github.io/2024/11/01/%E5%85%B3%E4%BA%8E%E6%9F%90%E5%A4%A7%E5%AD%A6%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%85%B1%E4%BA%AB%E4%B8%8A%E7%BD%91%E6%A3%80%E6%B5%8B%E6%9C%BA%E5%88%B6%E7%9A%84%E7%A0%94%E7%A9%B6%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</guid>
            <title>关于某大学校园网共享上网检测机制的研究与解决方案</title>
            <link>http://windsakura.github.io/2024/11/01/%E5%85%B3%E4%BA%8E%E6%9F%90%E5%A4%A7%E5%AD%A6%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%85%B1%E4%BA%AB%E4%B8%8A%E7%BD%91%E6%A3%80%E6%B5%8B%E6%9C%BA%E5%88%B6%E7%9A%84%E7%A0%94%E7%A9%B6%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</link>
            <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;关于某大学校园网共享上网检测机制的研究与解决方案&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#关于某大学校园网共享上网检测机制的研究与解决方案&#34;&gt;#&lt;/a&gt; 关于某大学校园网共享上网检测机制的研究与解决方案&lt;/h1&gt;
&lt;p&gt;Fork from &lt;a href=&#34;https://blog.sunbk201.site/posts/change-ua-by-proxy.html&#34;&gt;SunBK201 の Blog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks help!&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://t.me/crack_campus_network&#34;&gt;组织链接&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;前言&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#前言&#34;&gt;#&lt;/a&gt; 前言&lt;/h2&gt;
&lt;p&gt;关于本校的校园网，相信大家都知道是禁止单一账号下多设备同时访问互联网的，具体表现为 1 个账号只能同时让 1 台有线设备和 1 台无线设备接入互联网，这给我们一些拥有多设备的同学带来了很大的不便，因此不少同学想到了使用家用路由器的方式来解决这个为问题，然而校园网会进行共享上网检测，一旦发现一个 IP 下有多个不同设备的流量，就会封禁账号 2-8 小时不等，害的同学们怨声载道。&lt;/p&gt;
&lt;p&gt;然而奇怪的是本校内竟无应对此检测的方案，俗话说得好，道高一尺魔高一丈，肯定是有办法解决这个问题的。 因此本人出于学术兴趣，针对本校校园网共享上网检测机制进行了研究分析，并针对该机制提出了一些解决方案。&lt;/p&gt;
&lt;h2 id=&#34;对于本校校园网网络环境的说明&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#对于本校校园网网络环境的说明&#34;&gt;#&lt;/a&gt; 对于本校校园网网络环境的说明&lt;/h2&gt;
&lt;p&gt;校园网网络硬件设备：锐捷三层交换机（目前已知&lt;/p&gt;
&lt;p&gt;校园网认证系统：Drcom Web Portal 认证&lt;/p&gt;
&lt;p&gt;校园网网络防火墙安全方案：深信服&lt;/p&gt;
&lt;h2 id=&#34;为什么本校要禁止多设备共享上网&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#为什么本校要禁止多设备共享上网&#34;&gt;#&lt;/a&gt; 为什么本校要禁止多设备共享上网？&lt;/h2&gt;
&lt;p&gt;对于家用的上网资费，平均一年就要数百甚至上千元人民币，而校园网的资费一般都很低，如果一个宿舍只用一个账号一个路由器就可以实现全员上网的话，那 ISP 肯定要亏死，因此肯定会封禁像路由器这种设备的。&lt;/p&gt;
&lt;h2 id=&#34;本校校园网共享上网检测机制的研究&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#本校校园网共享上网检测机制的研究&#34;&gt;#&lt;/a&gt; 本校校园网共享上网检测机制的研究&lt;/h2&gt;
&lt;p&gt;目前已知的（可能）存在的有：&lt;/p&gt;
&lt;p&gt;基于 IPv4 数据包包头内的 TTL 字段的检测&lt;/p&gt;
&lt;p&gt;基于 HTTP 数据包请求头内的 User-Agent 字段的检测&lt;/p&gt;
&lt;p&gt;DPI (Deep Packet Inspection) 深度包检测技术&lt;/p&gt;
&lt;p&gt;基于 IPv4 数据包包头内的 Identification 字段的检测&lt;/p&gt;
&lt;p&gt;基于网络协议栈时钟偏移的检测技术&lt;/p&gt;
&lt;p&gt;Flash Cookie 检测技术&lt;/p&gt;
&lt;p&gt;下面我会对这些技术的实现原理作出进一步说明&lt;/p&gt;
&lt;h3 id=&#34;基于-ipv4-数据包包头内的-ttl-字段的检测&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于-ipv4-数据包包头内的-ttl-字段的检测&#34;&gt;#&lt;/a&gt; 基于 IPv4 数据包包头内的 TTL 字段的检测&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;存活时间（Time To Live，TTL），指一个数据包在经过一个路由器时，可传递的最长距离（跃点数）。 每当数据包经过一个路由器时，其存活次数就会被减一。当其存活次数为 0 时，路由器便会取消该数据包转发，IP 网络的话，会向原数据包的发出者发送一个 ICMP TTL 数据包以告知跃点数超限。其设计目的是防止数据包因不正确的路由表等原因造成的无限循环而无法送达及耗尽网络资源。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这是一个比较有效且合理的检测技术，IPv4 数据包下存在 TTL（Time To Live）这一字段，数据包每经过一个路由器（即经过一个网段），该 TTL 值就会减一。&lt;/p&gt;
&lt;p&gt;不同的操作系统的默认 TTL 值是不同的，Windows 是 128， macOS/iOS、Linux 是 64。&lt;/p&gt;
&lt;p&gt;因此如果我们自己接入路由器到校园网，我们的通过路由器的数据包会变为 127 或 63，一旦校园网抓包检测到这种数据包 TTL 不是 128 或 64，就会判定为用户接入了路由器。&lt;/p&gt;
&lt;h3 id=&#34;基于-http-数据包请求头内的-user-agent-字段的检测&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于-http-数据包请求头内的-user-agent-字段的检测&#34;&gt;#&lt;/a&gt; 基于 HTTP 数据包请求头内的 User-Agent 字段的检测&lt;/h3&gt;
&lt;p&gt;HTTP 数据包请求头存在一个叫做 User-Agent 的字段，该字段通常能够标识出操作系统类型，例如：&lt;/p&gt;
&lt;p&gt;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.72 Safari/537.36 Edg/89.0.774.45&lt;/p&gt;
&lt;p&gt;Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405&lt;/p&gt;
&lt;p&gt;校园网会通过多次抓包检测此字段，若发现同时出现例如 Windows NT 10.0 iPad 的字段，则判定存在多设备上网。&lt;/p&gt;
&lt;h3 id=&#34;dpi-deep-packet-inspection-深度包检测技术&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#dpi-deep-packet-inspection-深度包检测技术&#34;&gt;#&lt;/a&gt; DPI (Deep Packet Inspection) 深度包检测技术&lt;/h3&gt;
&lt;p&gt;这个检测方案比较先进，检测系统会抓包分析应用层的流量，根据不同应用程序的数据包的特征值来判断出是否存在多设备上网。&lt;/p&gt;
&lt;p&gt;具体可参考：&lt;a href=&#34;https://patents.google.com/patent/CN106411644A/zh&#34;&gt;基于 dpi 技术的网络共享设备检测方法及系统&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;此种方式已确认在锐捷相关设备上应用，当由于此项功能极耗费性能，因此有些学校可能不会开启此项功能。&lt;/p&gt;
&lt;h3 id=&#34;基于-ipv4-数据包包头内的-identification-字段的检测&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于-ipv4-数据包包头内的-identification-字段的检测&#34;&gt;#&lt;/a&gt; 基于 IPv4 数据包包头内的 Identification 字段的检测&lt;/h3&gt;
&lt;p&gt;IP 报文首部存在一个叫做 Identification 的字段，此字段用来唯 一标示一个 IP 报文，在实际的应用中通常把它当做一个计数器，一台主机依次发送的 IP 数据包内的 Identification 字段会对应的依次递增，同一时间段内，而不同设备的 Identification 字段的递增区间一般是不同的，因此校园网可以根据一段时间内递增区间的不同判断出是否存在多设备共享上网。&lt;/p&gt;
&lt;p&gt;具体可以参考此专利：&lt;a href=&#34;https://patents.google.com/patent/CN104836700A/zh&#34;&gt;基于 ipid 和概率统计模型的 nat 主机个数检测方法&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;不过经过我的抓包分析，Windows 的 TCP/IP 协议栈对 Identification 字段的实现是递增，而 iOS 的实现是保持全 0，因此校园网是否使用了该检测机制有待商榷。&lt;/p&gt;
&lt;h3 id=&#34;基于网络协议栈时钟偏移的检测技术&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于网络协议栈时钟偏移的检测技术&#34;&gt;#&lt;/a&gt; 基于网络协议栈时钟偏移的检测技术&lt;/h3&gt;
&lt;p&gt;不同主机物理时钟偏移不同，网络协议栈时钟与物理时钟存在对应关系，不同主机发送报文频率与时钟存在统计对应关系，通过特定的频谱分析算法，发现不同的网络时钟偏移来确定不同主机。&lt;/p&gt;
&lt;p&gt;具体可以参考此专利：&lt;a href=&#34;https://patents.google.com/patent/CN111970173A/zh&#34;&gt;一种基于时钟偏移的加密流量共享检测方法与装置&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;此种方式具有一定的实验性，因此我不认为此种方式投入了商用。&lt;/p&gt;
&lt;h3 id=&#34;flash-cookie-检测技术&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#flash-cookie-检测技术&#34;&gt;#&lt;/a&gt; Flash Cookie 检测技术&lt;/h3&gt;
&lt;p&gt;这个技术已经用不到了，Flash 都凉了。。不过还是提一下。&lt;/p&gt;
&lt;p&gt;Flash Cookie 会记录用户在访问 Flash 网页的时候保留的信息，只要当用户打开浏览器去上网，那么就能被 AC 记录到 Flash Cookie 的特征值，由于 Flash Cookie 不容易被清除，而且具有针对每个用户具有唯一，并且支持跨浏览器，所以被用于做防共享检测。&lt;/p&gt;
&lt;p&gt;具体参考：&lt;a href=&#34;https://bbs.sangfor.com.cn/plugin.php?id=sangfor_databases:index&amp;amp;mod=viewdatabase&amp;amp;tid=6273&#34;&gt;深信服防共享测试指导书&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;防共享上网检测的解决方案&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#防共享上网检测的解决方案&#34;&gt;#&lt;/a&gt; 防共享上网检测的解决方案&lt;/h2&gt;
&lt;p&gt;对于校园网重重的检测，我们似乎已经不可能从终端级提出一个完美的解决方案，因此，下面的解决方案都是基于网关级的。简单来说，我们需要在路由器上动手脚。&lt;/p&gt;
&lt;p&gt;路由器固件我们选择 OpenWrt，这是一个开源的路由器系统，允许我们自定义其系统内核以及添加自定义插件。&lt;/p&gt;
&lt;h3 id=&#34;基于-ipv4-数据包包头内的-ttl-字段的检测-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于-ipv4-数据包包头内的-ttl-字段的检测-2&#34;&gt;#&lt;/a&gt; 基于 IPv4 数据包包头内的 TTL 字段的检测&lt;/h3&gt;
&lt;p&gt;应对思路很简单：修改 TTL 为固定值。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 在 OpenWrt 路由器上安装必要的软件包&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg update &amp;amp;&amp;amp; opkg install iptables-mod-ipopt kmod-ipt-ipopt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;进入 OpenWRT 防火墙设置，在 自定义设置 中填入以下内容：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A POSTROUTING -j TTL --ttl-set 64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;基于-http-数据包请求头内的-user-agent-字段的检测-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于-http-数据包请求头内的-user-agent-字段的检测-2&#34;&gt;#&lt;/a&gt; 基于 HTTP 数据包请求头内的 User-Agent 字段的检测&lt;/h3&gt;
&lt;p&gt;应对思路：统一所有终端的 User-Agent 这一点实现起来有点困难，目前有三种解决方案。&lt;/p&gt;
&lt;h4 id=&#34;方案一通过-privoxy-修改-user-agent此方案不再建议使用&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#方案一通过-privoxy-修改-user-agent此方案不再建议使用&#34;&gt;#&lt;/a&gt; 方案一：通过 Privoxy 修改 User-Agent（此方案不再建议使用）&lt;/h4&gt;
&lt;p&gt;这个方案存在一个很大的缺点就是性能太差，会极大的拖慢我们的带宽，但也是最简单的方案。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 更新 OpenWRT 路由器的软件源，并安装 Privoxy 软件包&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg install privoxy luci-app-privoxy luci-i18n-privoxy-zh-cn&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;进入 Privoxy 管理页面设置，进入文件与目录，Action Files 中只保留 match-all.action，Filter Files 与 Trust Files 留空；进入访问控制，Listen Address 填写 0.0.0.0:8118，Permit Address 填写 192.168.0.0/16，勾选 Enable Action File Editor；进入杂项，勾选 Accept Intercepted Requests；进入日志，取消全部选项；点击保存并应用；进入 OpenWRT 防火墙设置，在自定义设置中填入以下内容：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 将局域网内的 HTTP 请求转发到 Privoxy 代理服务器上&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -N http_ua_drop&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -I PREROUTING -p tcp --dport 80 -j http_ua_drop&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A http_ua_drop -m mark --mark 1/1 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A http_ua_drop -d 0.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A http_ua_drop -d 127.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A http_ua_drop -d 192.168.0.0/16 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A http_ua_drop -p tcp -j REDIRECT --to-port 8118&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;打开  &lt;code&gt;http://config.privoxy.org/edit-actions-list?f=0&lt;/code&gt; ；点击 Edit，在 Action 那一列中，hide-user-agent 改选为 Enable - 在右侧 User Agent string to send 框中填写 &lt;code&gt;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36&lt;/code&gt; ，其它全部选择为 No Change；点击 Submit。&lt;/p&gt;
&lt;h4 id=&#34;方案二使用-xmurp-ua-修改-ua&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#方案二使用-xmurp-ua-修改-ua&#34;&gt;#&lt;/a&gt; 方案二：使用 XMURP-UA 修改 UA&lt;/h4&gt;
&lt;p&gt;这个方案需要手动交叉编译 OpenWRT，有功底的同学可以尝试。&lt;/p&gt;
&lt;p&gt;优点：这是个内核模块，因此性能不错&lt;/p&gt;
&lt;p&gt;缺点：因为是内核模块，因此稳定性欠佳，此外这个模块只能修改 80 端口的数据包，因此有些非 80 端口的数据包是修改不了的。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;git clone https://github.com/CHN-beta/xmurp-ua.git package/xmurp-ua&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make menuconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 在 Kernel module -&amp;gt; Other modules 里勾选 kmod-xmurp-ua（按 y）。保存退出。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 正常编译镜像，镜像中就会包含插件了。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果要单独编译此模块，需运行：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;make package/xmurp-ua/compile V=sc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd /tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pkg install 改成对应的xmurp-ua文件名.ipk&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 安装压缩内存插件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg install zram-swap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 检测这两个插件是否均已安装成功&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg list-installed | grep zram-swap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;opkg list-installed | grep xmurp-ua&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 重启路由器&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;reboot&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&#34;方案三使用-ua2f-修改-ua&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#方案三使用-ua2f-修改-ua&#34;&gt;#&lt;/a&gt; 方案三：使用 UA2F 修改 UA&lt;/h4&gt;
&lt;p&gt;这可能是最理想的方案，UA2F 可以修改所有端口的数据包，而且性能不错，不过依旧需要编译。 具体参见：&lt;a href=&#34;https://github.com/Zxilly/UA2F&#34;&gt;Zxilly/UA2F&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;验证方式：&lt;a href=&#34;http://ua.233996.xyz/&#34;&gt;UA 检测 - HTTP&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;方案四使用代理客户端中的重写功能对http-header进行修改&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#方案四使用代理客户端中的重写功能对http-header进行修改&#34;&gt;#&lt;/a&gt; 方案四：使用代理客户端中的重写功能对 http-header 进行修改&lt;/h4&gt;
&lt;p&gt;这应该是最容易操作的方法，也可能是有效的方法。&lt;/p&gt;
&lt;p&gt;以 Quantumult X 为例，只需在重写规则里面加入一条：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:// url request-header (\r\n)User-[A|a]gent:.+(\r\n) request-header $1User-Agent: $2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;iOS 客户端 Quantumult X、Shadowrocket、Surge 等都支持重写功能。&lt;/p&gt;
&lt;p&gt;Android 的客户端可以使用 surfboard（或许现在不支持了）。&lt;/p&gt;
&lt;p&gt;macOS 可以使用 Surge。&lt;/p&gt;
&lt;p&gt;Clash 用户要失望了，Clash 不支持 url 重写，不过可以使用 Clash 走规则匹配，把 http 流量全都加密。&lt;/p&gt;
&lt;p&gt;如果不想在自己的客户端上长时间开启代理，可以在 OpenWrt 中使用 OpenClash/ShellClash 进行网关级修改。&lt;/p&gt;
&lt;h3 id=&#34;基于-ipv4-数据包包头内的-identification-字段的检测-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于-ipv4-数据包包头内的-identification-字段的检测-2&#34;&gt;#&lt;/a&gt; 基于 IPv4 数据包包头内的 Identification 字段的检测&lt;/h3&gt;
&lt;p&gt;应对思路：修改所有数据包的 ID 字段为递增&lt;/p&gt;
&lt;p&gt;我们使用 &lt;a href=&#34;https://github.com/CHN-beta/rkp-ipid&#34;&gt;rkp-ipid&lt;/a&gt; 这一内核模块进行修改。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;git clone https://github.com/CHN-beta/rkp-ipid.git package/rkp-ipid&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make package/rkp-ipid/compile V=sc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 设置所有发出的数据包的 IPID 为递增&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -N IPID_MOD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A FORWARD -j IPID_MOD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A OUTPUT -j IPID_MOD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 0.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 127.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# iptables -t mangle -A IPID_MOD -d 10.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 172.16.0.0/12 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 192.168.0.0/16 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 255.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -j MARK --set-xmark 0x10/0x10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;基于网络协议栈时钟偏移的检测技术-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基于网络协议栈时钟偏移的检测技术-2&#34;&gt;#&lt;/a&gt; 基于网络协议栈时钟偏移的检测技术&lt;/h3&gt;
&lt;p&gt;应对思路：在局域网中建立 NTP 服务器统一时间戳&lt;/p&gt;
&lt;p&gt;进入 OpenWRT 系统设置，勾选 Enable NTP client（启用 NTP 客户端）和 Provide NTP server（作为 NTP 服务器提供服务）&lt;/p&gt;
&lt;p&gt;NTP server candidates（候选 NTP 服务器）四个框框分别填写:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ntp1.aliyun.com, time1.cloud.tencent.com, stdtime.gov.hk, pool.ntp.org&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;进入 OpenWrt 防火墙设置，在 自定义设置 中填入以下内容:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# 防时钟偏移检测&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -N ntp_force_local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -I PREROUTING -p udp --dport 123 -j ntp_force_local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -d 0.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -d 127.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -d 192.168.0.0/16 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -s 192.168.0.0/16 -j DNAT --to-destination 192.168.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 最后的 192.168.1.1 需要修改为路由器网关地址&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;确认效果：在 Windows 电脑上，打开控制面板，在右上角查看方式处选择小图标，然后点击 “日期和时间”。点击 Internet 时间 -&amp;gt; 更改设置，点几次 “立即更新”，直到提示 “时钟在 xxx 与 xxx 同步成功”。这时，暂时地拔掉墙上接口与路由器之间的网线（断开了外网的连接），再点一次 “立即更新”，应该仍然提示成功，这说明 NTP 请求已经被劫持到了路由器自身而不是外网。然后把网线插回&lt;/p&gt;
&lt;h3 id=&#34;flash-cookie-检测技术-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#flash-cookie-检测技术-2&#34;&gt;#&lt;/a&gt; Flash Cookie 检测技术&lt;/h3&gt;
&lt;p&gt;iptables 拒绝 AC 进行 Flash 检测&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# iptables 拒绝 AC 进行 Flash 检测&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -I FORWARD -p tcp --sport 80 --tcp-flags ACK ACK -m string --algo bm --string &amp;quot; src=\&amp;quot;http://1.1.1.&amp;quot; -j DROP&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;dpi-deep-packet-inspection-深度包检测技术-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#dpi-deep-packet-inspection-深度包检测技术-2&#34;&gt;#&lt;/a&gt; DPI (Deep Packet Inspection) 深度包检测技术&lt;/h3&gt;
&lt;p&gt;应对思路：加密数据包&lt;/p&gt;
&lt;p&gt;我们无法通过修改数据包来防止 dpi 检测，因此加密是最好的手段&lt;/p&gt;
&lt;h2 id=&#34;最后&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#最后&#34;&gt;#&lt;/a&gt; 最后&lt;/h2&gt;
&lt;p&gt;对于认为修改 UA IPID 太过麻烦的同学，可以直接对自己的流量进行全加密，前提是你的有充足的解密代理服务器&lt;/p&gt;
&lt;p&gt;下面我给出最终全部的配置脚本：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# @SunBK201 - https://www.sunbk201.site&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 通过 rkp-ipid 设置 IPID&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -N IPID_MOD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A FORWARD -j IPID_MOD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A OUTPUT -j IPID_MOD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 0.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 127.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#由于本校局域网是A类网，所以我将这一条注释掉了，具体要不要注释结合你所在的校园网&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# iptables -t mangle -A IPID_MOD -d 10.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 172.16.0.0/12 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 192.168.0.0/16 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -d 255.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A IPID_MOD -j MARK --set-xmark 0x10/0x10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# ua2f 改UA&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -N ua2f&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#由于本校局域网是A类网，所以我将这一条注释掉了，具体要不要注释结合你所在的校园网&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# iptables -t mangle -A ua2f -d 10.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -d 127.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -d 192.168.0.0/16 -j RETURN # 不处理流向保留地址的包&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -p tcp --dport 443 -j RETURN # 不处理 https&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -p tcp --dport 22 -j RETURN # 不处理 SSH &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -p tcp --dport 80 -j CONNMARK --set-mark 44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -m connmark --mark 43 -j RETURN # 不处理标记为非 http 的流 (实验性)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -m set --set nohttp dst,dst -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A ua2f -j NFQUEUE --queue-num 10010&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A FORWARD -p tcp -m conntrack --ctdir ORIGINAL -j ua2f&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A FORWARD -p tcp -m conntrack --ctdir REPLY&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 防时钟偏移检测&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -N ntp_force_local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -I PREROUTING -p udp --dport 123 -j ntp_force_local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -d 0.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -d 127.0.0.0/8 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -d 192.168.0.0/16 -j RETURN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t nat -A ntp_force_local -s 192.168.0.0/16 -j DNAT --to-destination 192.168.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# 通过 iptables 修改 TTL 值&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -t mangle -A POSTROUTING -j TTL --ttl-set 64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# iptables 拒绝 AC 进行 Flash 检测&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;iptables -I FORWARD -p tcp --sport 80 --tcp-flags ACK ACK -m string --algo bm --string &amp;quot; src=\&amp;quot;http://1.1.1.&amp;quot; -j DROP  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;对于防检测方案的可用性分析验证&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#对于防检测方案的可用性分析验证&#34;&gt;#&lt;/a&gt; 对于防检测方案的可用性分析验证&lt;/h2&gt;
&lt;p&gt;为检测方案的可用性，我进行了抓包分析。&lt;/p&gt;
&lt;p&gt;实验环境为：&lt;/p&gt;
&lt;p&gt;一台路由器（模拟校园网提供接入互联网服务）（192.168.5.1）&lt;/p&gt;
&lt;p&gt;一台抓包服务器 (192.168.5.219)(模拟检测系统)，提供 web 访问服务，以供客户机访问。&lt;/p&gt;
&lt;p&gt;一台路由器（模拟我们自己接入校园网的路由器）（192.168.5.190）&lt;/p&gt;
&lt;p&gt;两台客户机：一台 Win10（192.168.1.10）一台 iOS（192.168.1.20）&lt;/p&gt;
&lt;p&gt;两台客户机同时访问抓包服务器 (192.168.5.219) 进行抓包分析&lt;/p&gt;
&lt;h3 id=&#34;部署防检测方案前&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#部署防检测方案前&#34;&gt;#&lt;/a&gt; 部署防检测方案前&lt;/h3&gt;
&lt;p&gt;TTL: 127 / 63&lt;/p&gt;
&lt;p&gt;IPID: 64764-64779 / 0-0&lt;/p&gt;
&lt;p&gt;UA: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.72 Safari/537.36 Edg/89.0.774.45&lt;/p&gt;
&lt;p&gt;Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sunbk201.oss-cn-beijing.aliyuncs.com/img/20210614011914.png&#34; alt=&#34;img&#34;&gt; &lt;img src=&#34;https://sunbk201.oss-cn-beijing.aliyuncs.com/img/20210614012122.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;部署防检测方案后&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#部署防检测方案后&#34;&gt;#&lt;/a&gt; 部署防检测方案后&lt;/h3&gt;
&lt;p&gt;TTL: 64 / 64&lt;/p&gt;
&lt;p&gt;IPID: 2319-2504&lt;/p&gt;
&lt;p&gt;UA: FFFFFFFFFFFFFFFFFFFFFFFFFFFF&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sunbk201.oss-cn-beijing.aliyuncs.com/img/20210614011948.png&#34; alt=&#34;img&#34;&gt; &lt;img src=&#34;https://sunbk201.oss-cn-beijing.aliyuncs.com/img/20210614012220.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;最终结论防共享检测有效&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#最终结论防共享检测有效&#34;&gt;#&lt;/a&gt; 最终结论：防共享检测有效！&lt;/h3&gt;
&lt;h2 id=&#34;实际使用&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实际使用&#34;&gt;#&lt;/a&gt; 实际使用&lt;/h2&gt;
&lt;p&gt;我已经使用此方案一周之久，这一周内没有过发生一次封禁，可以肯定，此解决方案实际使用是有效的！&lt;/p&gt;
&lt;h2 id=&#34;写在最后&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#写在最后&#34;&gt;#&lt;/a&gt; 写在最后&lt;/h2&gt;
&lt;p&gt;我在写这篇文章的时候已经大三了，其实早在我大一的时候就有过一段时间来试图解决这个问题，但是当时能力还不够，无法拿出完整的解决方案，现在能力够了，但是也快毕业了，说实话现在再使用这些防检测方案已经有些晚了，不过，我相信这些解决方案可以对我们以后一些大一大二的同学有所帮助，我所做的一些工作也是值得的。&lt;/p&gt;
&lt;p&gt;具体操作见：&lt;a href=&#34;https://www.notion.so/OpenWrt-f59ae1a76741486092c27bc24dbadc59&#34;&gt;OpenWrt 编译与防检测部署教程&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果大家有疑问可以加讨论组： &lt;a href=&#34;https://t.me/crack_campus_network&#34;&gt;Telegram&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最后，感谢开发 OpenWrt 防检测模块的作者们 &lt;a href=&#34;https://github.com/Zxilly&#34;&gt;Zxilly&lt;/a&gt;、 &lt;a href=&#34;https://github.com/CHN-beta&#34;&gt;CHN-beta&lt;/a&gt; ，是有了他们的无私奉献，才使我能够整理出这么一份解决方案。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://windsakura.github.io/2024/11/01/VPN%E6%98%AF%E5%A6%82%E4%BD%95%E6%8E%A5%E7%AE%A1%E4%BD%A0%E7%9A%84%E6%B5%81%E9%87%8F%E7%9A%84%EF%BC%9F/</guid>
            <title>VPN是如何接管你的流量的？</title>
            <link>http://windsakura.github.io/2024/11/01/VPN%E6%98%AF%E5%A6%82%E4%BD%95%E6%8E%A5%E7%AE%A1%E4%BD%A0%E7%9A%84%E6%B5%81%E9%87%8F%E7%9A%84%EF%BC%9F/</link>
            <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;vpn是如何接管你的流量的&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#vpn是如何接管你的流量的&#34;&gt;#&lt;/a&gt; VPN 是如何接管你的流量的？&lt;/h1&gt;
&lt;p&gt;Fork from &lt;a href=&#34;https://blog.sunbk201.site/posts/vpn-route.html&#34;&gt;SunBK201&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如今，魔法道具逐渐成为了一些同学的常用 App，甚至必备 App，了解这些道具是如何接管你的网络流量显得很重要。&lt;/p&gt;
&lt;p&gt;目前，常见的接管方式有 3 种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;系统配置代理&lt;/li&gt;
&lt;li&gt;虚拟网卡接管&lt;/li&gt;
&lt;li&gt;网关透明代理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这里我主要谈前两种。&lt;/p&gt;
&lt;h2 id=&#34;系统配置代理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#系统配置代理&#34;&gt;#&lt;/a&gt; 系统配置代理&lt;/h2&gt;
&lt;p&gt;这种方式是最易实现的方式，绝大多数的操作系统都会向用户提供配置系统代理的选项，用户在手动或自动配置系统代理后， 向 Internet 发出的网络连接并不会直接向目标服务器发送，而是通过代理服务器转发给目标服务器。&lt;/p&gt;
&lt;p&gt;但由于系统只支持 HTTP、HTTPS、SOCKS 等代理协议，所以在使用这种方式时，用户配置的代理服务器一般并非远端代理服务器， 而是 127.0.0.1，通过将网络流量发送到位于本地的代理客户端，通过代理客户端对网络代理协议进行转换，最终将流量发送到远端代理服务器的代理服务端。&lt;/p&gt;
&lt;p&gt;对于部分 GUI 程序，用户可以直接通过操作系统提供的选项进行配置系统代理，诸如 Web 浏览器的网路连接都可以通过这种方式接管。&lt;/p&gt;
&lt;p&gt;对于 wget、curl、git 等 CLI 工具，我们可以通过设置环境变量 http_proxy，https_proxy 实现接管。&lt;/p&gt;
&lt;h2 id=&#34;虚拟网卡接管&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#虚拟网卡接管&#34;&gt;#&lt;/a&gt; 虚拟网卡接管&lt;/h2&gt;
&lt;p&gt;第一种系统配置代理的方式看似美好，但实际上又很大的限制。 系统配置代理并不能接管系统中的大多数流量，因为这种方式需要程序亲自去支持系统代理，也就是说如果软件的开发者并不打算 支持系统代理，那么系统配置代理的方式并不能接管到这些软件发出的流量。 这也就是为什么有些同学即使开了代理，也依旧无法连接外服游戏服务器进行流畅低延迟网游。&lt;/p&gt;
&lt;p&gt;既然系统配置代理有如此大的限制，那么我们需要怎么样的方式对我们系统中的绝大多数流量进行接管，简单来说，我们需要对进程进行强制接管，让程序无感知，而虚拟网卡接管就可以实现。&lt;/p&gt;
&lt;p&gt;简单来说，这是一种网络层级的接管，这种方式是通过在操作系统中建立虚拟网卡，并修改系统中的全局路由表实现的。 这里有 2 个关键点，一个是虚拟网卡，一个是全局路由表。&lt;/p&gt;
&lt;p&gt;虚拟网卡接管到的是网络层的流量，因此我们需要实现一个 TCP 协议栈对接管到的数据包进行重新的拆包解析，这也就是虚拟网卡的主要工作。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;TUN 是操作系统内核提供的三层虚拟网络设备。&lt;/p&gt;
&lt;p&gt;TAP 是二层 (以太网) 虚拟网络设备。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有了虚拟网卡，我们还需要让操作系统能够把网络流量发送给我们的虚拟网卡，而不是物理网卡，这就是全局路由表的工作。 任何系统网络层以上的网络流量都要按照路由表进行转发，因此修改系统全局路由表就是虚拟网卡接管的关键。&lt;/p&gt;
&lt;p&gt;那么，我们该如何修改路由表才能让网络流向虚拟网卡，下面我们来看下我的系统的路由表：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Internet:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Destination        Gateway            Flags           Netif Expire&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;default            192.168.0.1        UGScg             en0       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1                  198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2/7                198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4/6                198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8/5                198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16/4               198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32/3               198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64/2               198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128.0/1            198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127                127.0.0.1          UCS               lo0       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127.0.0.1          127.0.0.1          UH                lo0       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;169.254            link#11            UCS               en0      !&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192.168.0          link#11            UCS               en0      !&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192.168.0.1/32     link#11            UCS               en0      !&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192.168.0.1        b0:95:8e:ac:40:d4  UHLWIir           en0   1193&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192.168.0.104/32   link#11            UCS               en0      !&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192.168.0.255      ff:ff:ff:ff:ff:ff  UHLWbI            en0      !&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;198.18.0/15        198.18.0.1         UGSc            utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;198.18.0.1         198.18.0.1         UH              utun5       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;224.0.0/4          link#11            UmCS              en0      !&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;224.0.0.251        1:0:5e:0:0:fb      UHmLWI            en0       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;239.255.255.250    1:0:5e:7f:ff:fa    UHmLWI            en0       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;255.255.255.255/32 link#11            UCS               en0      !&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;首先，第一条是我的默认路由，它的出口是我的物理网卡。 接下来的第二条到第九条则是我们的虚拟网卡接管方式所修改的，而这几条是最关键的。 对于配置过路由表的同学可能对其他几条路由的含义是了解的，但是对于第二条到第九条，可能并不熟悉，甚至感到怪异， 因为这种路由太少见了。&lt;/p&gt;
&lt;p&gt;让我解释下，198.18.0.1 是我的虚拟网卡 ip 地址，即 utun5，也就是我们的网络流量的目的地址。 而第二条到第九条的 Destination，  &lt;code&gt;1&lt;/code&gt; ,  &lt;code&gt;2/7&lt;/code&gt; ,  &lt;code&gt;4/6&lt;/code&gt; ,  &lt;code&gt;8/5&lt;/code&gt; ,  &lt;code&gt;16/4&lt;/code&gt; ,  &lt;code&gt;32/3&lt;/code&gt; ,  &lt;code&gt;64/2&lt;/code&gt; ,  &lt;code&gt;128.0/1&lt;/code&gt; ，是代表着各网络 ip 端：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;1 : 1.0.0.0 - 1.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;2/7 : 2.0.0.0 - 3.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;4/6 : 4.0.0.0 - 7.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;8/5 : 8.0.0.0 - 15.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;16/4 : 16.0.0.0 - 31.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;32/3 : 32.0.0.0 - 63.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;64/2 : 64.0.0.0 - 127.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;128.0/1 : 128.0.0.0 - 255.255.255.255&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以看到，这些 ip 段覆盖的全部的 IPv4 的地址，因此所有的出口流量都会流向我们的虚拟网卡 utun5，而不是第一条默认路由。&lt;/p&gt;
&lt;h2 id=&#34;网关透明代理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#网关透明代理&#34;&gt;#&lt;/a&gt; 网关透明代理&lt;/h2&gt;
&lt;p&gt;这种代理方式将代理客户端从我们的个人终端转移到路由网关，个人终端无需进行任何配置，因此称作透明代理。 在这种方式下，我们的网关作为代理客户端负责加密流量拆包和封包。可以理解为第二种方式中虚拟网卡就是这里的路由网关。 只不过这里路由网关是物理的，并非虚拟的。 当然网关可以是虚拟的，这也就是一些客户端实现网管代理模式的思路。&lt;/p&gt;
&lt;p&gt;在网关透明代理方式下，局域网下所有终端设备的网络流量都可以被网关接管，因此，这种网关透明代理方式可以说是最一劳永逸的方式。&lt;/p&gt;
&lt;p&gt;总的来说，由于传统的系统配置代理方式的局限，虚拟网卡接管方式已经成为主流代理客户端的标配，而通过虚拟网卡与网关代理的结合， 又诞生出虚拟网卡接管局域网实现网关级代理的新方式，这些多样的方式让我们配置网络代理变得更加简单，更加灵活。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://windsakura.github.io/2024/11/01/hello-world/</guid>
            <title>Hello World</title>
            <link>http://windsakura.github.io/2024/11/01/hello-world/</link>
            <pubDate>Fri, 01 Nov 2024 14:14:27 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;1Welcome to &lt;a href=&#34;https://hexo.io/&#34;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&#34;https://hexo.io/docs/&#34;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&#34;https://hexo.io/docs/troubleshooting.html&#34;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&#34;https://github.com/hexojs/hexo/issues&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;quick-start&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#quick-start&#34;&gt;#&lt;/a&gt; Quick Start&lt;/h2&gt;
&lt;h3 id=&#34;create-a-new-post&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#create-a-new-post&#34;&gt;#&lt;/a&gt; Create a new post&lt;/h3&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo new &lt;span class=&#34;string&#34;&gt;&amp;quot;My New Post&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/writing.html&#34;&gt;Writing&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;run-server&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#run-server&#34;&gt;#&lt;/a&gt; Run server&lt;/h3&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/server.html&#34;&gt;Server&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;generate-static-files&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#generate-static-files&#34;&gt;#&lt;/a&gt; Generate static files&lt;/h3&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo generate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/generating.html&#34;&gt;Generating&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;deploy-to-remote-sites&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#deploy-to-remote-sites&#34;&gt;#&lt;/a&gt; Deploy to remote sites&lt;/h3&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo deploy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/one-command-deployment.html&#34;&gt;Deployment&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
